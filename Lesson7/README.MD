# Лекция 7
## Домашняя работа
Примечание: Прочитать https://vcfvct.files.wordpress.com/2015/06/do-you-really-get-classloaders.pdf

### <span style="color:green"> Задание 1

(Необязательно сложное задание)*  
Ваша задача написать загрузчик плагинов в ваше приложение.
Допустим вы пишите свою игру и хотите чтобы люди имели возможность писать плагины для неё. Соответственно, разные
разработчики могут назвать свои
классы одинаковым именем, ваш загрузчик должен корректно это обрабатывать.

* Модуль pluginManager:
    * модуль browser
    * модуль plugins:
        * модуль BasicPlugin
        * модуль HugerPlugin
        * модуль MyPlugin

  Перед запуском требуется выполнить

```bash 
mvn clean install
```

### <span style="color:green"> Задание 2

(Обязательно)  
Написать EncryptedClassloader  
Данный класслоадер умеет загружать классы из файлов дешифруя их, если они были зашифрованы. Ваша задача
переопределить метод findClass(). В нем лоадер считывает зашифрованный массив байт, дешифрует его и превращает в
класс (с помощью метода defineClass).  
На вход класслодер принимает ключ шифрования, рутовую папку, в которой будет искать классы, родительский класслодер.
Логика шифрования/дешифрования с использованием ключа может быть любой на ваш вкус (например, каждый считаный байт
класса увеличить на определение число).

* Модуль encryptedClassLoader  
  Перед запуском требуется выполнить

```bash 
mvn clean install
```

Класс Main демонстрирует работу с двумя основными компонентами — шифратором (Encryptor) и загрузчиком
(EncryptedClassLoader). Давайте разберем весь процесс пошагово:

#### 1. <span style="color:olive"> Шифрование класса
```java
Encryptor encryptor = new Encryptor(new File(sourceFilePath), new File(targetFilePath), encryptionKey);
encryptor.encryptAndSaveClass(nameClass);
```
* Создается объект Encryptor, который принимает путь к исходному файлу (sourceFilePath), путь для сохранения
        зашифрованного файла (targetFilePath), и ключ шифрования (encryptionKey).
* Метод encryptAndSaveClass:
  1. Загружает байтовый код класса (Sample.class) из sourceFilePath.
  2. Шифрует его, используя заданный ключ.
  3. Сохраняет зашифрованный файл в targetFilePath.

#### 2. <span style="color:olive"> Дешифрование и загрузка класса
```java
EncryptedClassLoader decryption = new EncryptedClassLoader(encryptionKey, new File(targetFilePath), Main.class.
getClassLoader());
Class<?> loadedClass = decryption.findClass(nameClass);
```

*	Создается объект EncryptedClassLoader, который принимает:  
      *	Ключ дешифрования (encryptionKey),  
      *	Каталог с зашифрованным файлом (targetFilePath),  
      *	Родительский загрузчик классов (Main.class.getClassLoader).  
*	Метод findClass:  
  1.	Ищет зашифрованный файл класса (Sample.class) в каталоге targetFilePath.  
  2.	Считывает его содержимое.  
  3.	Дешифрует байты, используя ключ.  
  4.	Преобразует дешифрованные байты обратно в класс с помощью метода defineClass.  

#### 3. <span style="color:olive"> Создание экземпляра класса и вызов метода
```java
Object instance = loadedClass.getDeclaredConstructor().newInstance();
loadedClass.getMethod("printMessage").invoke(instance);
```
*	Создается экземпляр загруженного класса (Sample.class) с помощью рефлексии:
  1.	getDeclaredConstructor().newInstance() — вызывает конструктор класса без параметров.
  2.	getMethod("printMessage").invoke(instance) — вызывает метод printMessage у созданного объекта.
*	Метод printMessage должен быть определен в классе Sample.

#### 4 <span style="color:olive"> EncryptedClassLoader
Этот код представляет собой реализацию пользовательского загрузчика классов (custom class loader) в Java. Он 
используется для загрузки зашифрованных классов из указанного каталога (dir) с использованием определённого ключа 
(key) для их расшифровки.

__Основные моменты работы кода:__  

___1.	Наследование от ClassLoader:___  
*	Класс EncryptedClassLoader наследует стандартный загрузчик классов (ClassLoader) и переопределяет метод 
     findClass. Этот метод используется для загрузки класса по имени.
___2.	Конструктор:___  
*	Конструктор принимает:  
    *	key — строку, которая используется для дешифрования содержимого файлов классов.  
    *	dir — каталог, где находятся зашифрованные файлы классов.  
    *	parent — родительский загрузчик классов.  

___3.	Метод findClass:___  
      Метод выполняет следующие шаги:  
1)Определяет путь к файлу класса:  
Входное имя classFileName (например, MyClass.class) используется для построения 
полного пути к файлу в каталоге dir.  
2)Читает содержимое файла:  
Файл считывается в массив байтов bytes с помощью Files.readAllBytes.  
3)Дешифрует содержимое:  
Вызывает метод decrypt, чтобы выполнить дешифрование содержимого байтового массива.  
4)Определяет класс:  
Метод defineClass преобразует байтовый массив в объект Class.  



### <span style="color:green">  Задание 3 - Не выполнено

(Необязательно, очень сложное задание)**  
Написать игру камень-ножницы-бумага, где в роли игроков будут выступать плагины (файлы с расширением jar).
Будет папка с плагинами, куда будет смотреть приложение.  
Каждый плагин должен иметь своё название (по названию файла или по внутреннему состоянию кода).  
Плагины будут загружаться по очереди и три раза играть в камень-ножницы-бумагa.  
Плагин-победитель остаётся в памяти, а проигравший выгружается.  
На место проигравшего загружается следующий плагин из папки и снова происходит игра.  
Данные действия повторяются, пока мы не определим плагин-победитель (его название «имя» будет написано в кансоли). Также
по сообщениям из консоли мы должны осозновать, что происходит в процессе отбора победителя.
Предположительно плагин-игрок должен содержать в себе реализацию интерфейса, пример:  
Interface PlayableRockPaperScissors {
RockPaperScissorsEnum play();
}
